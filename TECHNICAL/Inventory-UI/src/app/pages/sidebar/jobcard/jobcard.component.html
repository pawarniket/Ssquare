<div *ngIf="vehicleDetails" class="d-flex justify-content-end">

  <button class="btn btn-success btn-sm" (click)="back()">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
      class="bi bi-arrow-left me-1" viewBox="0 0 16 16">
      <path fill-rule="evenodd"
        d="M15 8a.5.5 0 0 1-.5.5H3.707l4.147 4.146a.5.5 0 0 1-.708.708l-5-5a.5.5 0 0 1 0-.708l5-5a.5.5 0 0 1 .708.708L3.707 7.5H14.5A.5.5 0 0 1 15 8z" />
    </svg>
    Back
  </button>
  

</div>

<div class="job-card" [formGroup]="jobCardForm" *ngIf="vehicleDetails" class="p-4 bg-white rounded shadow-sm">

  <!-- Customer Details -->
  <div class="section mb-4" formGroupName="customer">
    <h3 class="mb-3">Customer Details</h3>
    <div class="form-row">
      <div class="col-md-6">
        <label for="name">Name:</label>
        <input id="name" type="text" formControlName="name" class="form-control" placeholder="Enter customer's name">
      </div>
      <div class="col-md-6">
        <label for="phone">Phone:</label>
        <input id="phone" type="text" formControlName="phone" class="form-control" placeholder="Enter phone number">
      </div>
    </div>
  </div>

  <!-- Vehicle Details -->
  <div class="section mb-4" formGroupName="vehicle">
    <h3 class="mb-3">Vehicle Details</h3>
    <div class="form-row">
      <div class="col-md-3">
        <label for="number">Vehicle Number:</label>
        <input id="number" type="text" formControlName="number" class="form-control" placeholder="Enter vehicle number">
      </div>
      <div class="col-md-3">
        <label for="model">Model:</label>
        <input id="model" type="text" formControlName="model" class="form-control" placeholder="Enter vehicle model">
      </div>
      <div class="col-md-3">
        <label for="color">Color:</label>
        <input id="color" type="text" formControlName="color" class="form-control" placeholder="Enter vehicle color">
      </div>
      <div class="col-md-3">
        <label for="kmReading">Km Reading:</label>
        <input id="kmReading" type="number" formControlName="kmReading" class="form-control" placeholder="Enter Km Reading">
      </div>
    </div>
  </div>

  <!-- Service Details -->
  <div class="section mb-4" formGroupName="service">
    <h3 class="mb-3">Service Details</h3>
    <textarea rows="4" formControlName="work" class="form-control" placeholder="Describe the required services"></textarea>
  </div>

  <!-- Products/Parts Used -->
  <div class="section mb-4">
    <h3 class="mb-3">Products/Parts Used</h3>
    <div formArrayName="products" id="product-list" class="product-list">
      <div *ngFor="let product of products.controls; let i = index" [formGroupName]="i" class="product-item mb-3 p-3 border rounded">
        <div class=" col-md-12 form-row align-items-center">
          <div class="col-md-6">
            <select formControlName="ProductID" class="form-control">
              <option value="">-- Select Product --</option>
              <option *ngFor="let product of productList" [value]="product.ProductID">{{ product.ProductName }}</option>
            </select>
          </div>
          <div class="col-md-4">
            <input type="number" formControlName="Quantity" class="form-control" placeholder="Quantity">
          </div>
          <div class="col-md-2">
            <button type="button" class="btn btn-danger  w-100" (click)="deleteProduct(i)">
              <i class="fa-solid fa-trash"></i> Delete
            </button>
          </div>
        </div>
      </div>
    </div>
    <button class="btn btn-primary" (click)="addProduct()">+ Add More Product</button>
  </div>
<!-- Mechanic Selection -->
<div class="section mb-4">
  <h3 class="mb-3">Select Mechanic</h3>
  <select formControlName="mechanicName" class="form-control">
    <option value="">-- Select Mechanic --</option>
    <option *ngFor="let mechanic of mechanicList" [value]="mechanic.FullName">{{ mechanic.FullName }}</option>
  </select>
</div>

<!-- Status -->
<div class="section mb-4">
  <h3 class="mb-3">Job Status</h3>
  <select formControlName="status" class="form-control">
    <option value="">-- Select Status --</option>
    <option *ngFor="let status of statusList" [value]="status">
      {{ status }}
    </option>
  </select>
</div>

<!-- Payment Mode -->
<div class="section mb-4">
  <h3 class="mb-3">Payment Mode</h3>
  <select formControlName="paymentMode" class="form-control">
    <option value="">-- Select Payment Mode --</option>
    <option *ngFor="let mode of paymentModes" [value]="mode">
      {{ mode }}
    </option>
  </select>
</div>
  <!-- Mechanic Remarks -->
  <div class="section mb-4">
    <h3 class="mb-3">Mechanic Remarks</h3>
    <textarea rows="3" formControlName="remarks" class="form-control" placeholder="Mechanic's observations"></textarea>
  </div>

  <!-- Save Button -->
  <div class="text-center">
    <button class="btn btn-success btn-lg" (click)="save()">Save Job Card</button>
  </div>

</div>


  

<div *ngIf="!vehicleDetails" class="page-wrapper">
  <div class="content">
      <div class="page-header">
          <div class="add-item d-flex justify-content-between align-items-center">
              <div class="page-title">
                  <h4 class="fw-bold">JobCard List</h4>
                  <h6>Manage your Client Jobcards </h6>
              </div>
              

          </div>


      </div>

  </div>
</div>




  <div  *ngIf="!vehicleDetails" class="container bg-white rounded p-4 mt-4 shadow">
    <div class="row align-items-center justify-content-between mb-4">
      <!-- Title and Search -->
      <div class="col-md-6 d-flex align-items-center gap-3">
        <!-- <h3 class="fw-bold mb-0">Booking List</h3> -->
  
        <form class="input-group w-100" role="search">
          <input type="search" class="form-control" placeholder="Search here" aria-label="Search bookings"
            (keyup)="onSearch($event)" autocomplete="off" />
          <span class="input-group-text">
            <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/a2d24a7ceb684c1f468bdd9e1e90fbb04e0da74d9655bc2729b38bcacb6192d0"
              alt="Search" style="width: 16px;" />
          </span>
        </form>
      </div>
  
      <!-- Print Button -->
      <!-- <div class="col-md-3 text-end">
        <button (click)="printTable()" class="btn btn-black">
          <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/2c4cd31f4573b466716d0076623b4003b678b69f9e6f4b56e543f3956469a44c"
            alt="Print" style="width: 16px;" />
          Print
        </button>
      </div> -->
    </div>
  
    <!-- Table Section -->
    <div  class="table-responsive">
      <table class="table  text-left align-middle" id="bookinglisttable">
        <thead class="bg-black text-white">
          <tr>
  
            <th (click)="sortTable('ClientName')" style="cursor:pointer">
              Client Name <i [ngClass]="getSortIcon('ClientName')" class="ms-1"></i>
            </th>
          
            <th (click)="sortTable('Phone')" style="cursor:pointer">
              Phone <i [ngClass]="getSortIcon('Phone')" class="ms-1"></i>
            </th>
            <th (click)="sortTable('status')" style="cursor:pointer">
              Status <i [ngClass]="getSortIcon('status')" class="ms-1"></i>
            </th>
            <th (click)="sortTable('mechanicName')" style="cursor:pointer">
              Mechanic Name <i [ngClass]="getSortIcon('mechanicName')" class="ms-1"></i>
            </th>
            <th (click)="sortTable('paymentMode')" style="cursor:pointer">
              Payment Mode <i [ngClass]="getSortIcon('paymentMode')" class="ms-1"></i>
            </th>
            <th (click)="sortTable('JobCardDate')" style="cursor:pointer">
              Date <i [ngClass]="getSortIcon('JobCardDate')" class="ms-1"></i>
            </th>
            <th class="text-center">Action
            </th>
          </tr>
        </thead>
        <tbody>
          <tr class="text-left" *ngFor="let Clientlist of getPaginatedData()">
            <td>{{ Clientlist.ClientName }}</td>
            <td>{{ Clientlist.Phone }}</td>
            <td>{{ Clientlist.Status }}</td>
            <td>{{ Clientlist.MechanicName }}</td>
            <td>{{ Clientlist.PaymentMode }}</td>
            <td>{{ Clientlist.JobCardDate| date:'dd-MMM-yyyy'  }}</td>
            <td>
              <div class="d-flex justify-content-center gap-2">
                <button class="btn btn-primary btn-sm" 
                (click)="printInvoice()">
                <i class="fas fa-file-invoice"></i> Generate Bill
              </button>
                <button class="btn btn-primary btn-sm" 
                  (click)="selectJob(Clientlist,true)">
                  <i class="fas fa-edit"></i> Edit
                </button>
              
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  <div *ngIf="toastVisible" class="toast align-items-center border-0 show"
     role="alert" aria-live="assertive" aria-atomic="true"
     [ngClass]="['text-bg-' + toastColor]" style="position: fixed; top: 5rem; right: 1rem; z-index: 1055;">
  <div class="d-flex">
    <div class="toast-body">
      {{ toastMessage }}
    </div>
    <button type="button" class="btn-close btn-close-white me-2 m-auto"
            (click)="hideToast()" aria-label="Close"></button>
  </div>
</div>

  
  
    <!-- Pagination -->
    <div class="d-flex justify-content-end align-items-center gap-3 mt-3">
      <button class="btn btn-secondary btn-sm" (click)="prevPage()" [disabled]="currentPage === 1">
        Previous
      </button>
      <span>Page {{ currentPage }} of {{ totalPages }}</span>
      <button class="btn btn-secondary btn-sm" (click)="nextPage()" [disabled]="currentPage === totalPages">
        Next
      </button>
    </div>
  </div>
  