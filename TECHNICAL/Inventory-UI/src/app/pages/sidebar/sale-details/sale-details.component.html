<div class="page-wrapper">
  <div class="content">
      <div class="page-header">
          <div class="add-item d-flex justify-content-between align-items-center">
              <div class="page-title">
                  <h4 class="fw-bold">Sale Product</h4>
                  <!-- <h6>Manage your Employee </h6> -->
              </div>
<!--               
          <div class="page-btn">
              <a class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addemployee"><i
                      class="ti ti-circle-plus me-1"></i>Add Employee </a>
          </div> -->
          </div>


      </div>

  </div>
</div>


<div class="container my-5">
  <div  class="card p-3 mb-4 position-relative shadow-sm">
    <h5 class="mb-4 text-primary">Customer Info</h5>
    <div class="row">
      <!-- Customer Dropdown -->
      <div class="col-md-6">
        <label class="form-label">Select Customer <span class="text-danger">*</span></label>
        <select class="form-select" [(ngModel)]="selectedClient">
          <option value="" selected>Select Customer</option>
          <option *ngFor="let client of ClientList" [value]="client.ClientID">
            {{ client.ClientName + ' - ' + client.Phone }}
          </option>
        </select>
      </div>
  
      <!-- Add Customer Modal Trigger -->
      <div class="col-md-6">
        <span
          class="position-absolute top-0 end-0 me-4 mt-4 fs-4 text-success"
          data-bs-toggle="modal"
          data-bs-target="#ClientModel"
          role="button">‚ûï</span>
      </div>
    </div>
  
    <!-- Add Product Section -->
    <div class="col-md-12 mt-4">
      
      <h5 class="text-primary">Add Product</h5>
      <div class="row g-3">
        <!-- Product Dropdown -->
        <div class="col-md-3">
          <label class="form-label">Product<span class="text-danger">*</span></label>
          <select id="product" class="form-select" [(ngModel)]="selectedProductID" (change)="onProductChange()">
            <option value="">Select Product</option>
            <option *ngFor="let product of StockList" [value]="product.ProductID">
              {{ product.ProductName }}
            </option>
          </select>
        </div>
  
        <!-- Price Input -->
        <div class="col-md-3">
          <label class="form-label">Price (‚Çπ)</label>
          <input type="number" id="price" class="form-control" [(ngModel)]="selectedPrice" placeholder="0" readonly />
        </div>
  
        <!-- Quantity Input -->
        <div class="col-md-3">
          <label class="form-label">Qty</label>
          <input type="number" id="qty" class="form-control"  [(ngModel)]="quantity" (input)="checkQuantity()" placeholder="0" 
          [ngClass]="{ 'is-invalid': quantity > Quntity }"

          />
          <div *ngIf="quantity > Quntity" class="invalid-feedback">
            Quantity cannot exceed available stock ({{ Quntity }}).
          </div>
        </div>
  
        <!-- Total Price -->
        <div class="col-md-3">
          <label class="form-label">Total (‚Çπ)</label>
          <input type="number" class="form-control" [(ngModel)]="selectedPrice" [value]="totalPrice" readonly 
          
          />
        </div>
  
        <!-- Add Button -->
        <div class="col-md-2">
          <button class="btn btn-success w-100" (click)="addItem()">Add</button>
        </div>
      </div>
    </div>
  
    <!-- Bill Summary -->
     <div  id="printcontent">
    <h5 class="mt-4 text-primary">üßæ Bill Summary</h5>
    <div class="table-responsive">
      <table class="table table-striped align-middle text-center">
        <thead class="table-light">
          <tr>
            <th>Sr No</th>
            <th>Product</th>
            <th>Price</th>
            <th>Qty</th>
            <th>Total</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of billItems; let i = index">
            <td>{{ i + 1 }}</td>
            <td>{{ item.ProductName }}</td>
            <td>‚Çπ{{ item.Price }}</td>
            <td>{{ item.Qty }}</td>
            <td>‚Çπ{{ item.Total }}</td>
            <td>
              <button class="btn btn-danger btn-sm" (click)="removeItem(i)">üóëÔ∏è</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  
    <!-- Grand Total -->
    <div class="text-end total-box mt-3 fw-bold">
      <h4>Grand Total: ‚Çπ{{ grandTotal }}</h4>
    </div>
  </div>
    <!-- Submit Button -->
    <div class="text-end mt-4">
      <button class="btn btn-primary px-4 py-2" (click)="logProducts()">Submit & Print</button>
    </div>
  </div>
  
    </div>







<!-- Modal Client-->
<div class="modal fade" id="ClientModel" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true"
  data-bs-backdrop="static">
  <div class="modal-dialog modal-lg">
    <div class="modal-content shadow-lg">

      <!-- Header -->
      <div class="modal-header text-white rounded-top" style="background-color: #8c1818;">
        <h5 class="modal-title d-flex align-items-center" id="modalLabel">
          <i class="bi bi-box-seam me-2"></i>
          {{ Clientform.value.ClientID ? 'Update' : 'Add' }} Client
        </h5>
        <button type="button" id="closebtn" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"
          (click)="Resetform()"></button>
      </div>

      <!-- Body -->
      <div class="modal-body">
        <form [formGroup]="Clientform" class="add-product-form">
          <div class="add-product">
            <div class="accordions-items-seperate" id="accordionSpacingExample">
              <div class="accordion-item mb-4">
                <h2 class="accordion-header" id="headingSpacingOne">
                  <div class="accordion-button collapsed bg-white" data-bs-toggle="collapse"
                    data-bs-target="#SpacingOne" aria-expanded="true" aria-controls="SpacingOne">
                    <div class="d-flex align-items-center justify-content-between flex-fill">
                      <h5 class="d-flex align-items-center">
                        <i class="bi bi-info-circle-fill  me-2" style="color: #8c1818;"></i>
                        <span>Client Information</span>
                      </h5>
                    </div>
                  </div>
                </h2>

                <div id="SpacingOne" class="accordion-collapse collapse show" aria-labelledby="headingSpacingOne">
                  <div class="accordion-body border-top">

                    <!-- Row 1 -->
                    <div class=" col-12 mb-3">
                      <label class="form-label fw-semibold text-muted">Client Name <span
                          class="text-danger">*</span></label>
                      <input type="text" class="form-control" formControlName="ClientName"
                        placeholder="Enter Client Name*">
                      <div *ngIf="Clientform.get('ClientName')?.invalid && Clientform.get('ClientName')?.touched"
                        class="text-danger text-sm mt-1">
                        Client Name is required.
                      </div>
                    </div>
                    <div class=" col-12 mb-3">
                      <label class="form-label fw-semibold text-muted">Email <span class="text-danger">*</span></label>
                      <input type="text" class="form-control" formControlName="Email" placeholder="Enter Email *">
                      <div *ngIf="Clientform.get('Email')?.invalid && Clientform.get('Email')?.touched"
                        class="text-danger text-sm mt-1">
                        Email is required.
                      </div>
                    </div>
                    <div class=" col-12 mb-3">
                      <label class="form-label fw-semibold text-muted">Phone <span class="text-danger">*</span></label>
                      <input type="text" class="form-control" inputmode="numeric" maxlength="10" formControlName="Phone"
                        placeholder="Enter Phone *">
                      <div *ngIf="Clientform.get('Phone')?.touched && Clientform.get('Phone')?.invalid">
                        <div class="text-danger text-sm mt-1"
                          *ngIf="Clientform.get('Phone')?.errors?.['required']; else checkPattern">
                          Phone is required.
                        </div>
                        <ng-template #checkPattern>
                          <div class="text-danger text-sm mt-1"
                            *ngIf="Clientform.get('Phone')?.errors?.['pattern']; else checkMinLength">
                            Only numbers are allowed.
                          </div>
                        </ng-template>
                        <ng-template #checkMinLength>
                          <div class="text-danger text-sm mt-1" *ngIf="Clientform.get('Phone')?.errors?.['minlength']">
                            Minimum 10 digits required.
                          </div>
                        </ng-template>
                      </div>

                    </div>

                    <div class="col-12 mb-3">
                      <label class="form-label fw-semibold text-muted">Address <span
                          class="text-danger">*</span></label>
                      <textarea type="text" class="form-control" formControlName="Address"
                        placeholder="Enter Address *"></textarea>
                      <div *ngIf="Clientform.get('Address')?.invalid && Clientform.get('Address')?.touched"
                        class="text-danger text-sm mt-1">
                        Address is required.
                      </div>
                    </div>




                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Buttons -->
          <div class="col-lg-12">
            <div class="d-flex align-items-center justify-content-end gap-2 mb-3">
              <button type="button" class="btn btn-outline-secondary px-4" data-bs-dismiss="modal"
                (click)="Resetform()">Cancel</button>
              <button type="submit" class="btn btn-primary px-4" (click)="Client()">
                {{ Clientform.value.ClientID ? 'Update' : 'Add' }} Client
              </button>
            </div>
          </div>

        </form>
      </div>
    </div>
  </div>
</div>